<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Management</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css">
</head>
<body>
    <div class="container">
        <h1 class="text-center my-4">Team Management</h1>

        <!-- Create Team Form -->
        <h2>Create Team</h2>
        <form id="createTeamForm">
            <label for="teamName">Team Name:</label>
            <input type="text" id="teamName" name="teamName" required><br><br>

            <label for="teamImage">Upload Team Image:</label>
            <input type="file" id="teamImage" name="teamImage" accept="image/*" required><br><br>

            <button type="submit" class="btn btn-primary">Create Team</button>
        </form>

        <hr>

        <!-- Update Team Form -->
        <h2>Update Team</h2>
        <form id="updateTeamForm">
            <label for="teamId">Team ID:</label>
            <input type="text" id="teamId" name="teamId" required><br><br>

            <label for="newTeamName">New Team Name:</label>
            <input type="text" id="newTeamName" name="newTeamName"><br><br>

            <label for="newTeamImage">Upload New Team Image:</label>
            <input type="file" id="newTeamImage" name="newTeamImage" accept="image/*"><br><br>

            <button type="submit" class="btn btn-warning">Update Team</button>
        </form>

        <hr>

        <!-- Retrieve Teams -->
        <h2>Retrieve Teams</h2>
        <button id="retrieveTeamsBtn" class="btn btn-info">Get All Teams</button>
        <div id="teamsList" class="mt-4"></div>
    </div>

    <script>
        const apiBaseUrl = "https://localhost:7248"; // Adjusted to match your local API
        const authToken = localStorage.getItem("authToken");

        // Redirect to login if no token is found
        if (!authToken) {
            alert("You must be logged in to access this page.");
            window.location.href = "login.html"; // Redirect to login page
        }

        // Create Team
        document.getElementById('createTeamForm').addEventListener('submit', async function (event) {
            event.preventDefault();

            const teamName = document.getElementById('teamName').value;
            const teamImage = document.getElementById('teamImage').files[0];

            const formData = new FormData();
            formData.append('teamName', teamName);
            formData.append('teamImage', teamImage);

            try {
                const response = await fetch(`${apiBaseUrl}api/team`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: formData
                });

                if (!response.ok) {
                    throw new Error('Failed to create team');
                }

                const result = await response.json();
                alert('Team created successfully');
                console.log(result);
            } catch (error) {
                alert('Error: ' + error.message);
            }
        });

        // Update Team
        document.getElementById('updateTeamForm').addEventListener('submit', async function (event) {
            event.preventDefault();

            const teamId = document.getElementById('teamId').value;
            const newTeamName = document.getElementById('newTeamName').value;
            const newTeamImage = document.getElementById('newTeamImage').files[0];

            const formData = new FormData();
            if (newTeamName) formData.append('teamName', newTeamName);
            if (newTeamImage) formData.append('teamImage', newTeamImage);

            try {
                const response = await fetch(`${apiBaseUrl}api/team/${teamId}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: formData
                });

                if (!response.ok) {
                    throw new Error('Failed to update team');
                }

                const result = await response.json();
                alert('Team updated successfully');
                console.log(result);
            } catch (error) {
                alert('Error: ' + error.message);
            }
        });

        // Retrieve Teams
        document.getElementById('retrieveTeamsBtn').addEventListener('click', async function () {
            try {
                const response = await fetch(`${apiBaseUrl}api/team`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (!response.ok) {
                    throw new Error('Failed to retrieve teams');
                }

                const teams = await response.json();
                const teamsList = document.getElementById('teamsList');
                teamsList.innerHTML = '';

                teams.forEach(team => {
                    const teamElement = document.createElement('div');
                    teamElement.innerHTML = `
                            <h4>${team.teamName}</h4>
                            <img src="https://localhost:7248/images/${team.teamImage}" alt="${team.teamName}" width="200" />
                        `;
                    teamsList.appendChild(teamElement);
                });
            } catch (error) {
                alert('Error: ' + error.message);
            }
        });
    </script>
</body>
</html>
